<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加药物</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script src="../static/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/layui/layui.js"></script>
    <script src="../static/js/doctorconfig.js" type="text/javascript"
            charset="utf-8"></script>
</head>
<body>
<form class="layui-form  layui-form-pane" action="" lay-filter="form1">
    <div class="layui-form-item">
        <label class="layui-form-label">病单号</label>
        <div class="layui-input-block">
            <input type="text" name="stuRegister" id="stuRegister" class="layui-input" disabled="" title="不允许修改">
        </div>
    </div>

<!--    <div class="layui-form-item">-->
<!--        <label class="layui-form-label">医师账号</label>-->
<!--        <div class="layui-input-block">-->
<!--            <input type="text" name="docNum" lay-verify="docNum" class="layui-input" disabled="" title="不允许修改">-->
<!--        </div>-->
<!--    </div>-->
<!--    <div class="layui-form-item">-->
<!--        <label class="layui-form-label">医师姓名</label>-->
<!--        <div class="layui-input-block">-->
<!--            <input type="text" name="docName" lay-verify="docName" class="layui-input" disabled="" title="不允许修改">-->
<!--        </div>-->
<!--    </div>-->

<!--    <div class="layui-form-item">-->
<!--        <label class="layui-form-label">处方药物</label>-->
<!--        <div class="layui-input-block">-->
<!--            <input type="text" name="docName" lay-verify="docName" class="layui-input" disabled="" title="不允许修改">-->
<!--        </div>-->
<!--    </div>-->

    <div class="layui-form-item">
        <label class="layui-form-label">选取药物1</label>
        <div class="layui-input-block">
            <select name="medicName1" lay-verify="required" lay-search id="choseType" lay-filter="choseType">
                <option value="">可以搜索</option>
                <option value="null">无</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">选取药物一数量</label>
        <div class="layui-input-block">
            <select name="medicAmount1" lay-verify="required" lay-search>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">选取药物2</label>
        <div class="layui-input-block">
            <select name="medicName2" lay-verify="required" lay-search id="choseType1" lay-filter="choseType1">
                <option value="">可以搜索</option>
                <option value="null">无</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">选取药物二数量</label>
        <div class="layui-input-block">
            <select name="medicAmount2" lay-verify="required" lay-search>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">选取药物3</label>
        <div class="layui-input-block">
            <select name="medicName3" lay-verify="required" lay-search id="choseType2" lay-filter="choseType2">
                <option value="">可以搜索</option>
                <option value="null">无</option>
            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">选取药物三数量</label>
        <div class="layui-input-block">
            <select name="medicAmount3" lay-verify="required" lay-search>
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
    </div>


    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="addForm">提交数据</button>
        </div>
    </div>
</form>

<script type="text/javascript">
    layui.use(['table', 'element', 'layedit', 'laydate', 'form', 'upload'], function () {
        var table = layui.table;
        var layer = layui.layer;
        var layedit = layui.layedit;
        var laydate = layui.laydate;
        var form = layui.form;
        var element = layui.element;
        var upload = layui.upload;

        var docNum = $.cookie("docNum");
        $("#docNum").text(docNum);

        var docName = $.cookie("docName");
        $("#docName").text(docName);


        /* 表单提交 */
        form.on('submit(addForm)',function(data){
            $.ajax({
                url: '../docinfo/updateDrugList',
                method: 'post',
                data: data.field,
                success: function(data){
                    if(data.code==0){
                        layer.msg("修改成功", {
                            icon: 6,
                            time: 1200,
                            shade: 0.4
                        }, function() {
                            var layerIndex = parent.layer.getFrameIndex(window.name);//获取当前iframe的索引
                            parent.layer.close(layerIndex); //执行当前弹出窗口
                            parent.layui.table.reload('drugaddinfo');//重新加载父页面的表格数据
                        });
                    }else if(data.code == 1){
                        layer.msg(data.msg);
                        parent.window.location.href="../LoginIndex.html"; //session失效返回登录页
                    }else{
                        layer.msg(data.msg);
                    }
                },
                error: function(){
                    layer.msg("服务器内部错误");
                }
            });
            return false; //去掉该行layer不关闭
        });

        //加载药物类型
        $(document).ready(function() {
            $.ajax({
                url: '../medicNews/list',
                success: function(data) {
                    if (data.code == 0) {
                        $('#choseType').empty();
                        var btype = data.data;
                        //$('#choseType').append(new Option("药物类型选择","0"));
                        //                                    显示，存放信息
                        $.each(btype, function(index, item) {
                            $('#choseType').append(new Option(item.medicName,item.medicName));
                        });
                        // form.render();

                        $('#choseType1').empty();
                        var btype1 = data.data;
                        $.each(btype1, function(index, item) {
                            $('#choseType1').append(new Option(item.medicName,item.medicName));
                        });
                        // form.render();

                        $('#choseType2').empty();
                        var btype2 = data.data;
                        $.each(btype2, function(index, item) {
                            $('#choseType2').append(new Option(item.medicName,item.medicName));
                        });
                        form.render();
                    } else {
                        layer.alert("请求失败，未找到数据");
                    }
                },
                error: function(data) {
                    layer.alert("类型加载失败！");
                }
            })
        });






    });
</script>


</body>
</html>