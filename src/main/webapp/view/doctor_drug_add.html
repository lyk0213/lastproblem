<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>医生获取开具</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script src="../static/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/layui/layui.js"></script>
    <script src="../static/js/doctorconfig.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div>
    <div class="demoTable">
        <input type="text" name="docNum" hidden="hidden"/>
        <input type="text" name="docName" hidden="hidden"/>
        <form class="layui-form"  lay-filter="form1">
            <div class="layui-form-item">

                <div class="layui-inline">
                    <label class="layui-form-label">学生账号</label>
                    <div class="layui-input-block">
                        <input type="text" name="stuNum" id="stuNum" placeholder="请输入" autocomplete="off"
                               class="layui-input">
                    </div>
                </div>

                <div class="layui-inline">
                    <button class="layui-btn layuiadmin-btn-useradmin" lay-submit
                            lay-filter="LAY-user-front-search" type="button" id="searchBtn">
                        <i class="layui-icon layui-icon-search layuiadmin-button-btn"></i>
                    </button>
                </div>
                <div class="layui-inline">
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>

    <table id="drugaddinfo" lay-filter="drugaddinfo"></table>

    <script type="text/html" id="toolBar">
        <div class="layui-btn-container">
            <button class="layui-btn layui-btn-sm" lay-event="reloadTable" >刷新表格</button>
        </div>
    </script>

    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="add">开具药品</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="edic">清单修改</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="copy">打印</a>
    </script>
</div>

<script type="text/javascript">
    layui.use([ 'table','element','layedit', 'laydate','form','jquery'],function() {
        var table = layui.table;
        var layer = layui.layer;
        var layedit = layui.layedit;
        var laydate = layui.laydate;
        var form = layui.form;
        var element = layui.element;
        var $ = layui.jquery;

        var docNum = $.cookie("docNum");
        $("#docNum").text(docNum);
        var docName = $.cookie("docName");
        $("#docName").text(docName);

        //数据表格数据渲染
        var tableIns = table.render({
            elem : '#drugaddinfo',
            toolbar : '#toolBar',
            height : 439,
            url : '../docinfo/drugquery',
            page : true, //开启分页
            cols : [[
                {field : 'stuNum',title : '学生账号',width : 140,sort: true},
                {field : 'stuName',title : '学生姓名',width : 140,sort: true},
                {field : 'diagnosticResults',title : '药物开具信息',width : 140,sort: true},
                {field : 'endMoney',title : '药物总价格',width : 140,sort: true},
                {field : 'payType',title : '付费状态',width : 140,sort: true},
                {fixed : 'right',title : '操作状态',width : 210,align : 'center',toolbar : '#barDemo'}
            ]]

        });

        // {field : 'endMoney',title : '药物总价格',width : 140,sort: true},
        // {field : 'payType',title : '付费状态',width : 140,sort: true},

        /* 查询按钮 */
        $('#searchBtn').click(function(){
            layer.msg('请稍后...',{
                icon:16,
                time:800,
                shade:0,
            },function(){
                tableIns.reload({
                    where:{
                        stuNum: $('#stuNum').val(),
                    },page:{
                        page: 1
                    }
                })
            })
        });


        //监听表格工具头
        table.on('toolbar(drugaddinfo)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id);
            switch(obj.event){
                case 'reloadTable': tableIns.reload();break;
            };
        });

        //监听表格按钮事件
        table.on('tool(drugaddinfo)',function(obj){
            var data = obj.data; //获取表格行数据
            if(obj.event == 'add'){
                addDruginfo(data);
            }else if (obj.event == 'edic'){
                edicDruginfo(data);
            }else if (obj.event == 'copy'){
                copyDruginfo(data);
            }
        });

        function addDruginfo(data)  {
            layer.open({
                type: 2,
                title: '药物处方单信息',
                area: ['800px','600px'],
                fixed: false,
                maxmin: true,
                content: 'doctor_drug_add_info.html',
                success: function(layero,index){
                    var body = layer.getChildFrame('body',index);
                    body.find('#stuRegister').val(data.stuRegister);//传递病历单号到子页面
                    body.find('#docNum').val(docNum);//传递病历单号到子页面
                    body.find('#docName').val(docName);
                }
            })
        };

        function edicDruginfo(data) {

        };

        function copyDruginfo(data) {

        };





    });
</script>
</body>
</html>