<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生信息显示</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css">
    <script src="../static/js/jquery-3.5.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
    <script src="../static/layui/layui.js"></script>
    <script src="../static/js/doctorconfig.js" type="text/javascript"
            charset="utf-8"></script>
</head>
<body>
<form class="layui-form"  action=""  lay-filter="form1">
    <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素  form1进行下方ajax中的取值判断-->
    <!-- 第一个信息将sid进行影藏 -->
    <input type="text" name="did" hidden="hidden" />

    <div class="layui-form-item">
        <label class="layui-form-label">医生姓名</label>
        <div class="layui-input-block">
            <input type="text" name="docName" lay-verify="docName" class="layui-input" disabled="" title="不允许修改">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">账号名</label>
        <div class="layui-input-block">
            <input type="text" name="docNum" id="docNum" class="layui-input" disabled="" title="不允许修改">
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">登录密码</label>
        <div class="layui-input-block">
            <input type="password" name="docPwd" class="layui-input" lay-verify="docPwd" placeholder="不修改则不填">
        </div>
    </div>
    <!--    可以改，需要在controller中进行查找并且保持原样-->

    <div class="layui-form-item">
        <label class="layui-form-label">性别</label>
        <div class="layui-input-block">
            <input type="radio" name="docSex" value="男" title="男">
            <input type="radio" name="docSex" value="女" title="女" >
            <!-- value传出的数值 -->
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">医师等级</label>
        <div class="layui-input-block">
            <input type="text" name="docLevel" class="layui-input" lay-verify="docLevel" disabled="" title="不允许修改">
        </div>
    </div>


    <div class="layui-form-item">
        <label class="layui-form-label">当前职位</label>
        <div class="layui-input-block">
            <input type="text" name="docPosition" class="layui-input" lay-verify="docPosition" disabled="" title="不允许修改">
        </div>
    </div>

    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="formDemo">提交修改</button>
        </div>
    </div>
</form>

<script type="text/javascript">
    layui.use(['element','layer','jquery','form','form','upload'], function(){
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功

        var element = layui.element;
        var layer = layui.layer;
        var $ = layui.jquery;
        var upload = layui.upload;
        var form = layui.form;

        //获取cookie值，进行后续的ajax中的交互
        var docNum = $.cookie("docNum");
        $("#docNum").text(docNum);

        $.ajax({
            url: '../docinfo/selectByDocNum?docNum='+docNum,
            method: 'get',
            success: function(data) {
                if(data.code==0){
                    /* 表单赋值 */
                    form.val('form1',{
                        did: data.data.did,
                        docName: data.data.docName,
                        docNum: data.data.docNum,
                        docPwd: data.data.docPwd,
                        docType: data.data.docType,
                        docSex: data.data.docSex,
                        docTelephone: data.data.docTelephone,
                        docWorktime: data.data.docWorktime,
                        docLevel: data.data.docLevel,
                        docPosition: data.data.docPosition
                    });
                    // $('#hImg').attr('src',data.data.headImg);，图片文件可以存在，后续增加？
                }else{
                    layer.alert(data.msg);
                }
            },
            error: function(data){
                layer.alert(data.msg);
            }
        });
        form.verify({
            docPwd: function(value){
                if(value.length<6){return '密码至少6个字符';}
            },
        });
        /* 表单提交 */
        form.on('submit(formDemo)',function(data){
            $.ajax({
                url: '../docinfo/updateDocInfoBydocNum',
                method: 'post',
                data: data.field,
                success: function(data){
                    if(data.code==0){
                        layer.msg("修改成功。", {
                                icon: 6,
                                time: 1200,
                                shade: 0.4
                            }
                        );
                    }else{
                        layer.msg("修改失败，请重试");
                    }
                },
                error: function(){
                    layer.msg("服务器内部错误");
                }
            });
            return false; //去掉该行layer不关闭
        });
        //但是，如果你的HTML是动态生成的，自动渲染就会失效
        //因此你需要在相应的地方，执行下述方法来进行渲染
        form.render();//更新信息
    });
</script>
</body>
</html>